第四回: 確率と統計
===============

「データサイエンス入門」の第四回です。

データサイエンスでは、一般的に大規模なデータから有益な情報を抽出し、問題解決や意思決定の支援、未知の事象を予測することを目的とします。
その中心にあるのがデータ、そしてそのデータから何かを"推測"するための方法論が統計的推測となります。統計的推測は、我々が持つデータから未知の母集団の性質を推定したり、特定の仮説が真である確率を評価する手法を提供します。つまり、手元にある標本データを基に、データの背後に隠れたパターンや法則の発見を目指します。

統計的推測は大きく分けて、「統計的推定」と「仮説検定」の2つの側面を持ちます。統計的推定は未知のパラメータの値を推測するもので、点推定や区間推定があります。仮説検定は、主張したい仮説が真であるか否かを確率的に評価するものです。

統計的推定を理解するためには、まずは標本、確率といった統計的な概念の理解が重要です。この動画では、統計的推測の基礎的な概念となるこれらの項目について学びます。

## 母集団と標本

統計的推測の基本的な概念は、母集団と標本です。母集団とは、関心のある特定の集団全体を指します。例えば国民の全て、全ての製品、全ての患者などです。一方、標本とは、母集団から抽出された部分集合を指します。例えば、全国の人々から抽出された100人の標本、全ての製品の中の20製品などです。

実際のデータ分析では、標本から母集団の特性を推定することが一般的です。その理由は、母集団全体を調査することは困難であることが多いからです。例えば、日本中の全ての中学生の平均身長を調べには、手間も費用もかかるために現実的ではありません。そのため、全国の中学生から抽出された標本の身長を調べ、その平均身長を母集団の平均身長の推定値として用いることが一般的です。このように母集団から標本を抽出し、調査することを標本調査と呼びます。一方、母集団全体を調査することを全数調査と呼びます。我が国では、国勢調査が最も規模の大きな全数調査の例になります。

### 標本抽出

母集団から標本を抽出する方法として最も一般的なのが無作為抽出法です。この方法では、母集団から無作為、ランダムに標本が選ばれます。母集団を構成するすべての要素が等しい確率で選ばれるために、標本の公平性を確保します。一般的には標本が大きいほど、母集団の特性をより正確に反映する可能性があります。ですが、標本が大きいほど調査時間や費用も増えるため、標本の大きさは調査の目的や時間・費用とのトレードオフを考慮して決定する必要があります。

```r
set.seed(123)
# 1から100までの整数を生成
population <- seq.int(100)
# 10個の標本を無作為に抽出
sample <- sample(population, 10)
sample
#>  [1] 31 79 51 14 67 42 50 43 97 25
```

層化抽出法は標本抽出の方法の一つです。層化抽出法では、母集団をいくつかの層に分け、各層から無作為に標本を選びます。ここでの層とは、母集団を構成する要素の特徴に基づいて母集団を分けたものです。具体例を示すと、家計調査を行う際に、性別や年齢、職業などのいくつかの特徴をもとに母集団を分け、各層から無作為に標本を選ぶといった過程になります。この方法では、すべての家庭を代表した標本を選ぶことは期待できませんが、各年齢層や職業層を代表した標本を選ぶことは期待できます。

標本抽出により得られた標本から、未知の母集団の傾向を知るための一連の手法を統計的推測といいます。統計的推定では標本のとり方によって結果が変わることがあります。そのため、標本がどのようにして選ばれるのか、確率的な観点から考える必要があります。そのためには、確率変数と確率分布の概念を理解する必要があります。

## 確率変数と確率分布

確率とは、コイン投げやサイコロ投げのように、観測される結果が偶然によって決まる事象を表します。例えば、コイン投げでは表が出る確率と裏が出る確率は等しく、1/2です。サイコロ投げでは、1から6までの目が出る確率は等しく、1/6となります。確率は、0から1までの値をとり、1に近いほどその事象が起こる確率が高いことを表します。言い換えると、確率とは裏や表あるいは1から6までの目の「起きやすさ」を数値で表す方法となります。

一方、「表」や「裏」あるいは「1」や「2」などの結果を足し算や引き算などの演算で数学的に扱うためには、確率変数という概念を用います。コイン投げにおいて、表が出たら1、裏が出たら0であるような変数$X$を考えます。コイン投げの場合、表が出る確率が1/2であることを確率変数を用いて表現すると

$$
P(X = 1) = \frac{1}{2}
$$

とします。ここで、$X$は確率変数を表し、$X = 1$は表が出ることを表します。確率変数は、離散型確率変数と連続型確率変数に分けられます。離散型確率変数は、コインの裏表やサイコロの目のように、有限個の値をとる変数です。一方の連続型確率変数は身長や降水量のように、ある範囲の値をとる変数です。

確率変数が取り得る値とその値が出現する確率との対応関係を指すものを確率分布と呼びます。確率分布はデータの分布を表現するために用いられます。例えば、コイン投げの確率分布は次のように表されます。

| 事象 | $X$ | $P(X)$ |
|-----|-----|------|
| 表  | 1  | 1/2  |
| 裏  | 0  | 1/2  |


この確率分布は、コイン投げが一様分布に従うという事実を反映しています。一様分布とは、すべての結果が同じ確率で発生するという確率分布のことを指します。確率分布には一様分布以外にもたくさんの種類があります。

確率分布は確率変数の種類、すなわち離散型確率変数と連続型確率変数によって異なります。離散型確率変数の確率分布を離散確率分布、連続型確率変数の確率分布を連続確率分布と呼びます。代表的な離散確率分布として、二項分布、ベルヌーイ分布のほかにポアソン分布があります。連続確率分布には、正規分布や指数分布、ガンマ分布などがあります。これらの違いについて、それぞれ見ていきましょう。

### 確率分布

離散確率分布では、離散型確率変数Xが取り得る値すべてに確率を割り当てたものを確率関数と呼び、以下のように表します。

$$
P(X=x_i)=p_i, \qquad i=1,2,...,m
$$

確率関数ではすべての可能な出力値xについて、確率は0以上（つまり $P(X = x) >= 0$ ）、そしてすべての可能な出力値について、確率の和を求めると1となる、確率の公理に従います。すなわち、確率関数は次のような性質を持ちます。

$$
\sum_{i=1}^m P(X=x_i) = 1
$$

これに対して連続型確率変数では、特定の値が取る確率を求めると0になってしまいます。これは、連続型の確率変数が取りうる値の範囲が無限に広いため、一点における確率がほぼ0になるからです。それでは、連続確率変数をどのように扱えばよいでしょうか。連続型確率変数では、特定の値を取る確率を表現するのではなく、特定の範囲内に値が存在する確率を表現することが重要になります。

これを表現するために、連続型の確率分布では「確率密度関数」が使用されます。確率密度関数は、その名の通り「確率の密度」を表す関数です。確率密度関数は、確率変数がある値をとる確率を直接表現するのではなく、確率変数がある範囲の値をとる確率を表現します。確率密度関数は、次のように表されます。

$$
f(x) \geq 0, \qquad \int_{-\infty}^{\infty} f(x)dx = 1
$$

ここで示されるように、確率密度関数は次の2つの条件を満たす必要があります。

- 確率密度関数は非負の値である。どのようなxの値に対しても、$f(x)$はゼロまたはゼロより大きい
- 確率密度関数により得られる確率の和は1に等しい。言い換えると、確率密度変数が定義する全範囲を積分した結果は1となる。

それでは、確率密度と確率密度関数を使って離散確率分布と連続確率分布をグラフ上に表してみましょう。確率分布の形を知ることは、確率分布の理解を深めるのに役立ちます。

まず離散確率分布として一様分布を示します。一様分布はサイコロの出る目のように、すべての結果が同じ確率で発生する確率分布です。このような離散型確率変数の一様分布は離散一様分布と呼ばれます。確率関数は次のように表されます。

$$
P(X=x_i)=\frac{1}{m}, \qquad i=1,2,...,m
$$

この確率関数を利用してサイコロの出る目の離散一様分布をグラフ上に表すと、次のようになります。

グラフの横軸には出る目が並んでいます。グラフの縦軸が確率を表しています。繰り返しとなりますが、サイコロの出る目は1から6までの6つの値をとるため、それぞれの目が出る確率は1/6となります。このように、離散一様分布ではすべての結果が同じ確率で発生するため、グラフは平坦な直線となります。

このグラフの作成に利用したRのコードを示します。Rにはたくさんの確率分布を扱う関数が用意されています。ここでは、離散一様分布を表す関数である`dunif`を利用しています。`dunif`の第1引数には確率変数の値を、第2引数には確率変数がとる値の範囲の最小値を、第3引数には確率変数がとる値の範囲の最大値を指定します。この関数は、確率変数がとる値の範囲の最小値から最大値までのすべての値に対する確率を返します。

```r
x <- seq.int(6)
y <- dunif(x, 1, 6)
plot(x, y, 
     type = "h", 
     lwd = 3, 
     col = "#57467b", 
     ylim = c(0, 0.2), 
     xlab = "サイコロの出る目", 
     ylab = "確率",
     main = "サイコロの出る目の離散一様分布")
```

つづいて連続確率分布として正規分布を示します。正規分布は、身長や体重などのように、ある範囲の値をとる連続型確率変数の分布を表現するために用いられます。正規分布は、平均値と分散の2つのパラメータで表されます。平均値は分布の中心を表し、分散は分布の広がりを表します。正規分布の確率密度関数は次のように表されます。

$$
f(x) = \frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(-\frac{(x-\mu)^2}{2\sigma^2}\right)
$$

ここで、$\mu$は平均値、$\sigma^2$は分散を表します。分散は前回扱った内容です。正規分布の確率密度関数を利用して、平均値が0、分散が1の正規分布をグラフ上に表すと、次のようになります。

```r
# xの範囲を設定
x <- seq(-5, 5, by = 0.1)
y1 <- dnorm(x, mean = 0, sd = 1)
# グラフを描画
plot(x, y1, type = "l", 
     lwd = 3,
     col = "#57467b",
     ylim = c(0, 0.5), 
     xlab = "x", 
     ylab = "Density", 
     main = "正規分布")
```

正規分布は、平均値を中心とした左右対称の山の形をしています。平均値から離れるほど確率は小さくなります。

続いて、平均値は0のままで分散を0.2、5とした場合の2つの正規分布をグラフ上に重ねて表すと、次のようになります。

分散が0.2の場合は、平均値から離れるほど確率が小さくなることがわかります。一方、分散が5の場合は、平均値から離れても確率が小さくなることはありません。このように、正規分布では分散が大きいほど分布の広がりが大きくなります。

このグラフの作成に用いたRのコードを示します。正規分布を表す関数である`dnorm`を利用しました。`dnorm`の第1引数には確率変数の値を、第2引数には平均値を、第3引数には分散を指定します。この関数は、確率変数がとる値の範囲の最小値から最大値までのすべての値に対する確率を返します。

```r
# 平均0で標準偏差がそれぞれ0.2、5の正規分布の確率密度関数を計算
y2 <- dnorm(x, mean = 0, sd = 0.2)
y3 <- dnorm(x, mean = 0, sd = 5)
plot(x, y1, type = "l", 
     lwd = 3,
     col = "#57467b",
     ylim = c(0, max(c(y1, y2, y3))), 
     xlab = "x", 
     ylab = "Density", 
     main = "正規分布")
lines(x, y2, lwd = 3, col = "#7cb4b8")
lines(x, y3, lwd = 3, col = "#70f8ba")
# 凡例を追加
legend("topright", 
       legend = c("標準偏差 = 1", 
                  "標準偏差 = 0.2", 
                  "標準偏差 = 5"), 
       col = c("#57467b", "#7cb4b8", "#70f8ba"), 
       lty = 1,
       lwd = 3)
```

## まとめ

この動画では、統計的推測の基礎となる標本や確率について扱いました。統計的推測とは、標本を用いて、統計的な興味の対象を示す母集団の性質やパラメータに関する情報を得るための手法です。統計的推測には「統計的推定」と「仮説検定」の2種類があります。いずれもこの動画で学んだ確率や確率分布を用いて行われるため、この動画で学んだ内容が統計的推測の理解に役立つことでしょう。

次回は統計的推測の枠組みを用いた、データから母集団の特性を推定する方法である回帰分析を扱います。回帰分析により、母集団の特性を知るだけでなく、予測、理解にも役立てることができます。ぜひ次回もご覧ください。
