第五回: 回帰分析
===============

「データサイエンス入門」コースの第五回です。前回は、統計的推測の基礎となる確率について紹介しました。今回は、データサイエンスの分析手法の一つである回帰分析を扱います。

## 回帰分析の概要

私たちは日常的に「あれがこれに影響を与えている」、「今日がこうだったから明日はこうなるだろう」といったような関係性や傾向を考えています。もう少し具体的にすると、気温が上がるとアイスクリームの売り上げが増える、あるいは、学習時間が長いほどテストの成績が高くなるといった関係性です。このような関係性を数学的に表現するのが回帰分析です。

回帰分析は、我々が予測したい変数について、他の、一つまたは複数の変数を用いて予測を行う手法です。また、ある変数が予測対象の変数にどのように影響を及ぼすか、といったことも扱います。変数間の関係を線形モデルで表現することが多いので、線形回帰とも呼ばれます。一方で、変数間の関係を非線形モデルで表現する場合もあります。この場合は、非線形回帰と呼ばれます。ここでは線形回帰モデルに限定して説明します。

## 単回帰分析

回帰分析では、あつかう予測に使われる変数の数に応じて、単回帰分析と重回帰分析に分けられます。まずは、単回帰分析について説明します。

気温が上がるとアイスクリームの売り上げが増えるという関係性を考えます。このとき、気温の変化によってアイスクリームの売り上げが変化する関係性を扱います。そのため、現象を説明する変数を説明変数、予測したい変数を目的変数と呼びます。単回帰分析は、一つの説明変数を用いて目的変数との関連を見ていくことになります。

単回帰分析の基本的な形を数学的に表現すると、次のようになります。この式は高校数学でも習う、一次関数の式です。

$$
y = a \times x + b
$$

ここで$y$は目的変数、$x$は説明変数です。さきほどの例では、$y$はアイスクリームの売り上げ、$x$は気温になります。$a$と$b$は、それぞれ傾きと切片を表します。傾きは、説明変数の値が1単位増えたときに目的変数がどれだけ増えるかを表します。切片は、説明変数が0のときの目的変数の値を表します。この式を用いて、説明変数$x$から目的変数$y$を予測することができます。

<!-- 説明変数の値から目的変数の値を予測するということから「回帰」という名前がついています。 -->

### アイスクリームの売り上げと気温の関係をモデル化する

アイスクリームの売り上げと気温の関係がどのようになっているか、単回帰モデルを適用する前にその関係を可視化してみましょう。これにより、視覚的な理解を深めることができます。

```r
# 気温のデータを作成
temperature <- seq(18, 40, 4)
# アイスクリームの売り上げのデータを作成
icecream_sales <- c(28, 45, 72, 82, 96, 100)
# 散布図の作成
plot(temperature, icecream_sales)
```

散布図から、気温が上がるとアイスクリームの売り上げが増えることがわかります。この関係性を直線で表現することができれば、気温からアイスクリームの売り上げを予測することができます。中でも散布図に最もよくフィットする直線を見つけ出すことができれば、より精度の高い予測ができるようになります。この直線は「回帰直線」と呼ばれます。回帰直線は、傾きと切片を用いて表現されます。

```r
# 単回帰モデルの構築
# lm()関数の引数に 目的変数 ~ 説明変数 の形式で指定する
model <- lm(icecream_sales ~ temperature)
```

単回帰モデルでは、データに最も当てはまる回帰直線の傾きと切片を求めます。この傾きと切片を求める手法が「最小二乗法」です。最小二乗法は、データに最も当てはまる回帰直線を求める手法です。最小二乗法では、データと回帰直線の誤差の二乗和が最小になるような回帰直線を求めます。誤差の二乗和が最小になるような回帰直線を求めることで、回帰直線がデータに最も当てはまることになります。

さきほどの散布図にモデルが求めた回帰直線を追加してみましょう。

```r
# 回帰直線の追加
abline(model)
```

傾きと切片は、`lm()`関数で作成したモデルから取得することができます。

```r
# intercept... 切片
# coefficient... 傾き（係数）
coefficients(model)
#> (Intercept) temperature 
#>  -34.100000    3.735714 
```

回帰分析では、この回帰直線の傾きにあたる値を係数と呼びます。係数は、説明変数の値が1単位増えたときに目的変数がどれだけ増えるかを表します。この場合、傾きは3.73、切片は-34.1となっています。この結果は、気温が1度上がるとアイスクリームの売り上げが3.73個増えることを示唆します。

回帰直線を利用するとデータにない気温のデータが与えられたときのアイスクリームの売上を予測することもできます。次のRコードは気温30度のときのアイスクリームの売り上げを予測しています。

```r
predict(model, data.frame(temperature = 30))
#>        1 
#> 77.97143 
```

単回帰モデルを用いることで、説明変数の値から目的変数の数値的な変化を予測することが可能になります。しかし現実の問題では、アイスクリームの売り上げが気温だけで説明できないように、気温以外の要因も影響していることが多いです。例えば、天気が悪いとアイスクリームの売り上げが減ることが考えられます。このように、複数の説明変数を用いて目的変数を予測することを「重回帰分析」と呼びます。次にこの重回帰分析の例を紹介します。

## 重回帰分析

重回帰分析では、複数の説明変数を用いて目的変数を予測します。重回帰分析では、説明変数を$x_1, x_2, x_3, \cdots, x_n$、目的変数を$y$とすると、以下の式で表現されます。

$$
y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \cdots + \beta_n x_n
$$

この式は、単回帰分析の式と同じ形をしています。単回帰分析では、説明変数が1つでしたが、重回帰分析では説明変数が複数あることが違いです。重回帰分析では、説明変数が複数あるため、説明変数の数だけ係数があります。この係数を求めることで、説明変数の値から目的変数の値を予測することができます。

アイスクリームの売り上げのモデルに、気温のほかに影響がありそうな湿度と風速を説明変数として追加してみましょう。次のRコードでは、気温、湿度、風速を説明変数として重回帰モデルを構築しています。

```r
# 重回帰モデルの構築
humidity <- c(0.65, 0.8, 0.75, 0.85, 0.9, 0.8)
wind_speed <- c(2, 3, 4, 6, 3, 1)
model <- lm(icecream_sales ~ temperature + humidity + wind_speed)

coefficients(model)
#> (Intercept) temperature    humidity  wind_speed 
#>  -43.030028    3.829201   -3.741047    2.928650
```

単回帰モデルと同様、`lm()`関数を利用します。目的変数と説明変数の指定方法も共通です。
また、モデルの適用結果についても`coefficients()`関数で係数の取得が可能です。この結果から、気温、湿度、風速の3つの説明変数が、それぞれアイスクリームの売り上げに影響を与えているかががわかります。

ここでは係数の値と符号に注目します。湿度だけがマイナスの値の係数をもっています。これは、湿度が1上がることでアイスクリームの売り上げが3.74減少することを示唆します。一方、気温と風速はプラスの値の係数をもっています。これは、気温と風速がアイスクリームの売り上げに対してプラスの効果をもつことを示唆します。

このように、重回帰モデルでは複数の説明変数が目的変数に及ぼす影響を同時に評価することができます。一方で、係数の値を見るだけでは、どの説明変数が目的変数に影響を与えているかを判断することは難しいです。そこで、説明変数の影響を評価するために、係数の値を標準化する操作が求められます。また、説明変数の間で相関がある場合にはモデルの精度に影響を与えることがあります。そのため、適切な説明変数を取り入れることも重要となり、変数選択と呼ばれる操作が必要な場合もあります。
