第三回: データ分析の基礎
================

「データサイエンス入門」の第三回です。

前回はデータサイエンスではどのような作業があるのか、また実際の企業における活用例をいくつか紹介しました。
今回は「データ分析の基礎」と題して、データサイエンスの中で扱われる基本的な手法を紹介します。
具体的には、データサイエンスを行う際に遭遇する欠損値や外れ値の扱い方、記述統計によるデータの要約、ヒストグラムや箱ひげ図といったデータの可視化について解説します。

これらの基本的な分析手法を習得することで、データを理解し、データの背景にある関係性や課題に対する仮説設定に役立ちます。また、これらの手法を使いこなすことができれば、データサイエンスのより高度な技術へとスムーズに進むことができるでしょう。データ分析の基礎をしっかりと押さえて、データサイエンスの世界への理解を深めていきましょう。

## 欠損値と外れ値

手元に利用できるデータが用意されたとしても、直接分析に利用できる状態ではないことがあります。その理由は、これらのデータの中には、値がない状態の欠損値や、ほかの値とは極端に異なる外れ値が含まれていることがあるからです。欠損値や外れ値はデータ分析では他のデータと分けて考える必要があります。これらのデータは統計的な処理や分析に影響を及ぼすことがあるためです。データ分析を行う際には、欠損値や外れ値の扱い方を考える必要があります。

欠損値が問題となる例は平均値の計算でも見ることができます。Rでは平均値の計算を`mean()`関数を使って行います。

```r
mean(c(1, 3, 6, 10))
```

欠損値が含まれないデータに対しては正しく平均値が計算できるのに対し、欠損値を含んだデータでは正常に平均値を計算できません。

```r
mean(c(1, 3, NA, 6, 10))
```

そのため、`mean()`関数を適用する前に欠損値への対処を決めておくことになります。`na.rm`引数で欠損値を除外するかどうかを指定することができます。`na.rm = TRUE`とすることで欠損値を除外して平均値を計算することができます。

```r
mean(c(1, 3, NA, 6, 10), na.rm = TRUE)
```

引数として欠損値への対処が可能な関数もたくさんありますが、あらかじめ欠損値の処理を行っておくのが望ましいです。欠損値処理の方法は、欠損値がどのように発生しているのか？また、発生原因は？といった要素に応じてさまざまです。

外れ値についても問題となる例を見てみましょう。具体的な例として、ある動物の体重について、次のデータが得られている場面を考えます。

```r
# 動物の体重データ。単位はkg
x <- c(0.9, 1.1, 1.5, 5.4, 410.0)
```

このデータでの外れ値は、410kgという極端に大きな値です。それ以外のデータは10にも満たない小さな値です。これらの数値から平均値を求めると次の値が得られます。

```r
mean(x)
```

平均値は外れ値の影響を受けて大きな値になっています。平均値よりも大きなデータは外れ値の1つのデータだけで、それ以外のデータは平均値以下になっています。このように、外れ値の有無は統計量の値に大きな影響を与えることがあります。
外れ値や欠損値はデータの入力時に、人為的な誤りにより意図せずに生じることもあります。そのため、欠損値や外れ値の有無について、事前に確認しておくことが重要です。

## データの特徴を伝えるには？

データ分析の作業において、扱うデータの件数は一般的に膨大です。
ひとつひとつのデータを細かく見ていくことはできません。そのためデータの内容を整理し、簡潔に伝える必要があります。
データサイエンスにおいては、データの特徴を簡潔に伝えるために、記述統計という手法が用いられます。またグラフを用いてデータの特徴を伝えることもできます。

### 記述統計

記述統計とは、データの特徴を数値で表現する手法です。記述統計では、データの平均値や分散、最大値や最小値などの統計量を用いてデータの特徴を表現します。平均値や中央値はデータの代表点を示す情報となります。一方、分散や標準偏差はデータのばらつきを示す情報となります。

これらの統計量はRでは簡単に求めることができます。

```r
x <- c(1, 3, 6, 6, 10)
mean(x) # 平均値
median(x) # 中央値
mode(x) # 最頻値
```

また、複数の統計量を`summary()`関数でまとめて求めることもできます。


```r
summary(x)
```

ここで出力される1st Qu.、3rd Quは第一四分位点、第三四分位点と呼ばれる値です。第一四分位点はデータの下から25%の位置にある値、第三四分位点はデータの下から75%の位置にある値を表します。50%の位置にある第二四分位点は中央値と一致します。第一四分位点と第三四分位点の間の範囲を四分位範囲と呼びます。これらの四分位点の情報は、後述する箱ひげ図の作成に利用されます。

ばらつきを示す統計量は次のように求めることができます。

```r
var(x) # 分散
sd(x) # 標準偏差
```

分散と標準偏差の関係を詳しくみてみましょう。まずは分散です。分散は次の式で計算されます。

$$
\sigma^2 = \frac{1}{n}\sum_{i=1}^{n}(x_i - \mu)^2
$$

分散は $\sigma^2$ として表現するのが一般的です。ここで、$\mu$ は平均値、$n$ はデータの件数、$x_i$ はデータの値を表します。分散は、データの平均値からの偏差の二乗の平均値を表します。分散は、データのばらつきを表す指標です。分散の値が大きいほど、データのばらつきが大きいことを表します。

次に標準偏差です。標準偏差は次の式で計算されます。

$$
\sigma = \sqrt{\frac{1}{n}\sum_{i=1}^{n}(x_i - \mu)^2}
$$

標準偏差は $\sigma$ として表現します。これは分散の平方根を表します。標準偏差も、分散と同様にデータのばらつきを表す指標が、分散はデータの二乗の単位を持つため、元のデータの単位と異なる単位になってしまいます。一方、標準偏差はデータと同じ単位を持ちます。そのため、データのばらつきを表す指標としては標準偏差の方がよく用いられます。

### データの可視化

データの特徴を伝えるためには、記述統計のほかにグラフを用いることもできます。グラフを用いることで、データの特徴を直感的に理解することができます。ここではヒストグラムと箱ひげ図を紹介します。

#### ヒストグラム

データの分布を表現するためにヒストグラムが利用されます。ヒストグラムは、データを階級と呼ばれるいくつかの範囲に分け、階級ごとのデータの個数を柱の高さで表現したものです。

ヒストグラムは、Rでは`hist()`関数を使って作成することができます。ここでは北極に生育するアデリーペンギンの体重についてのヒストグラムを描画します。

```r
library(palmerpenguins) # ペンギンデータの読み込み
data("penguins")
# アデリーペンギンの体重データを抽出
x <- 
  subset(penguins, species == "Adelie", select = body_mass_g)[[1]]
# ヒストグラムの描画
hist(x, breaks = 10)
```

ヒストグラムを見ると、データの最小値から最大値までの範囲の情報の他、どの値が多く含まれているかといった情報を得ることができます。さきほどのヒストグラムでは3400から3600の範囲のデータが最も多く含まれていることがわかります。

ヒストグラムを扱う際は、階級数に気をつける必要があります。階級数が多すぎると、柱の数が多くなるためにデータの特徴を表現できなくなってしまうことがあるためです。一方、階級数が少なすぎてもデータの特徴を正確に表現することができません。次の図は先ほどのペンギンの体重データについて、異なる階級数を与えて作成したヒストグラムです。


#### 箱ひげ図

箱ひげ図は、「箱」と「ひげ」を使ってデータの分布を表現します。箱は四分位点の情報を使って作成されます。具体的には、データを小さい順から大きい順に並べた際の25%、75%に位置する第一四分位点、第三四分位点を箱の上下の境界とし、枠で囲むことで箱が描かれます。続いて、箱の中央に線を引き、中央値を表現します。これで箱の完成です。ヒゲの部分は、箱の上下の境界から1.5倍の四分位範囲を超える値までをひげとして描画します。ひげよりも小さな値・大きな値があれば外れ値として点として描画します。

箱ひげ図は、Rでは`boxplot()`関数を使って作成することができます。ここでは北極に生育するアデリーペンギンの体重についての箱ひげ図を描画します。

```r
boxplot(x)
```

このデータでは、箱の上下の境界が3350gから4000gの範囲になっていることがわかります。また、中央値は3700g程度であることがわかります。このデータでは、ヒゲの外側に点が表示されていないことから、外れ値となるような小さなあるいは大きなデータが含まれないことがわかります。

## まとめ

データ分析の基礎として、欠損値や外れ値の扱い方、記述統計、データの可視化について解説しました。これらの基礎的なデータの扱いは、現実問題のデータを扱う際には必ず必要となります。データの特徴を理解するためには、記述統計やデータの可視化を行うことが重要です。データ分析の基礎をしっかりと押さえて、次のステップへ進みましょう。次回は、データサイエンスの中心的な役割を担う統計的推測について学びます。